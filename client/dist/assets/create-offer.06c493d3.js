import{u as useTypedSelector,a as useActions,v as v4,E as ErrorBoundary}from"./react-error-boundary.esm.84b5157a.js";import{j as jsxs,a as jsx,r as react,u as useOnClickOutside,L as Label,A as Arrow,b as useVirtualizer,N as NoItems,F as Fragment,c as NumericalInput,B as ButtonDisabled,M as Modal,S as SearchField,C as CloseButton,d as api,e as coingeekoApi,f as useNetwork,g as useAccount,h as useQuery,i as BigNumber,Z as Zero,k as FiatServices,l as useNavigate,p as parseEther,m as usePrepareContractWrite,n as contractConfig,o as useContractWrite,q as useWaitForTransaction,O as OfferService,Q,R as React}from"./index.d4f6898f.js";const Preview=()=>{const{crypto:e,fiat:t,unitPrice:n,quantity:s,timeLimit:i,minLimit:r,maxLimit:l,offerComment:a,payMethods:o}=useTypedSelector(h=>h.createOfferReducer),{symbol:c,logoUrl:d}=e,{ticker:x,logoUrl:p}=t;return jsxs("div",{className:"bg-white rounded-[20px] shadow-customDark row-span-2 break-words h-full",children:[jsx("div",{className:"bg-purple rounded-t-[20px] p-5",children:jsx("p",{className:"text-white text-[32px] font-bold",children:"Preview"})}),jsxs("div",{className:"flex flex-col gap-5 p-5",children:[jsxs("div",{className:"flex items-center justify-between",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Crypto"})}),jsxs("div",{className:"flex gap-1 items-center",children:[jsx("img",{className:"image",src:d,alt:""}),jsx("span",{className:"font-medium",children:c})]})]}),jsxs("div",{className:"flex justify-between items-center",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Fiat"})}),jsxs("div",{className:"flex gap-1 items-center",children:[jsx("img",{className:"image",src:p,alt:""}),jsx("span",{className:"font-medium",children:x})]})]}),jsxs("div",{className:"flex justify-between",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Unit Price"})}),jsx("div",{children:jsxs("span",{className:"font-medium",children:[n," ",x]})})]}),jsxs("div",{className:"flex justify-between",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Quantity"})}),jsx("div",{children:jsxs("span",{className:"font-medium",children:[s," ",c]})})]}),jsxs("div",{className:"flex justify-between",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Total Amount"})}),jsx("div",{children:jsxs("span",{className:"font-medium",children:[+n*+s," ",x]})})]}),jsx("hr",{}),jsxs("div",{className:"flex justify-between",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Payment Methods"})}),jsx("div",{children:o.length?o==null?void 0:o.map((h,m)=>{var j,S;return jsxs("div",{className:"flex items-center gap-1 my-2",children:[jsx("img",{className:"image",src:(j=h==null?void 0:h.bank)==null?void 0:j.logoUrl,alt:""}),jsx("p",{children:(S=h==null?void 0:h.bank)==null?void 0:S.name})]},m)}):"-"})]}),jsx("hr",{}),jsxs("div",{className:"flex justify-between",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Time Limit"})}),jsx("div",{children:jsxs("span",{className:"font-medium",children:[i," min"]})})]}),jsxs("div",{className:"flex justify-between",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Price Limit"})}),jsx("div",{children:jsx("span",{className:"font-medium",children:`${r||""}-${l||""}`})})]}),jsxs("div",{className:"flex justify-between gap-5",children:[jsx("div",{children:jsx("span",{className:"font-bold text-lg",children:"Comment"})}),jsx("div",{children:jsx("p",{className:"font-medium",children:a})})]})]})]})},Dropdown=({value:e,fullName:t,onAction:n,label:s,data:i,image:r})=>{const l=react.exports.useRef(null);useOnClickOutside(l,()=>o(!1));const[a,o]=react.exports.useState(!1),c=d=>{n(d),o(!1)};return jsxs("div",{className:"relative w-full",ref:l,children:[s?jsx(Label,{label:s}):null,jsxs("button",{type:"button",onClick:()=>o(!a),className:"flex items-center justify-between cursor-pointer w-full inputBorder rounded-[15px] p-2",children:[jsxs("div",{className:"flex items-center space-x-2",children:[jsx("img",{className:"w-8 h-8 rounded-[50%] shadow-customDark object-cover",src:r,alt:""}),jsxs("span",{className:"font-bold",children:[e," ",jsx("span",{className:"font-bold text-gray-300",children:t})]})]}),jsx("div",{className:`transition duration-300 ${a&&"rotate-180"}`,children:jsx(Arrow,{})})]}),a&&jsx("div",{className:"rounded-[10px] absolute w-full shadow-2xl bg-white h-[250px] overflow-y-auto z-50",children:i.map((d,x)=>{const{ticker:p,logoUrl:h,name:m}=d;return jsxs("div",{onClick:()=>c(i[x]),className:"p-2 cursor-pointer flex items-center gap-1 hover:bg-lightGray transition-colors duration-300",children:[jsx("img",{className:"w-8 h-8 rounded-full shadow-customDark object-cover",width:32,height:32,src:h,alt:""}),jsxs("span",{className:"font-bold",children:[p," ",jsx("span",{className:"font-bold text-gray-300",children:m})]})]},x)})})]})},ModalInput=({onOpen:e,label:t,symbol:n,image:s,fullName:i})=>jsxs("div",{children:[jsx(Label,{label:t}),jsxs("button",{type:"button",onClick:()=>e(),className:"flex items-center space-x-2 w-full p-2 inputBorder rounded-[15px]",children:[jsx("img",{className:"w-8 h-8 rounded-[50%] shadow-customDark object-cover",src:s,alt:""}),jsxs("span",{className:"font-bold",children:[n," ",jsx("span",{className:"text-gray-300 font-bold",children:i})]})]})]}),Token=({virtualItem:e,token:t,close:n})=>{const{setCrypto:s}=useActions(),{symbol:i,balance:r,logoUrl:l,name:a,tokenAmount:o}=t,c=d=>{s(d),n()};return jsxs("button",{type:"button",onClick:()=>c(t),className:"flex items-center justify-between gap-2 px-3 cursor-pointer hover:bg-lightGray transition-colors duration-300 rounded-[15px]",style:{position:"absolute",top:0,left:0,width:"100%",height:`${e.size}px`,transform:`translateY(${e.start}px)`},children:[jsxs("div",{className:"flex items-center gap-3",children:[jsx("img",{className:"image",src:l,alt:""}),jsxs("div",{className:"flex flex-col items-start",children:[jsx("span",{className:"font-bold",children:a}),jsxs("span",{className:"text-gray tracking-wide font-medium",children:[o," ",i]})]})]}),jsx("div",{children:jsx("span",{className:"font-bold",children:`${r>0?`$${r}`:r}`})})]})},TokenList=({tokens:e,closeModal:t})=>{const n=react.exports.useRef(null),s=useVirtualizer({count:e==null?void 0:e.length,getScrollElement:()=>n.current,estimateSize:()=>75,overscan:5});return jsx("div",{style:{height:"400px",overflow:"auto",marginTop:"20px"},ref:n,children:e.length?jsx("div",{style:{height:`${s.getTotalSize()}px`,width:"100%",position:"relative"},children:s.getVirtualItems().map(i=>{const r=e[i.index];return jsx(Token,{token:r,virtualItem:i,close:t},i.key)})}):jsx(NoItems,{})})},skeleton="",Wrapper=({children:e})=>jsx("div",{className:"flex flex-col bg-white rounded-[20px] p-5 gap-5 shadow-customDark w-full",children:e}),CreateOfferStepOne=({tokens:e,allFiat:t})=>{const{setFiat:n,setQuantity:s,setUnitPrice:i,nextStep:r}=useActions(),{crypto:l,fiat:a,quantity:o,unitPrice:c}=useTypedSelector(v=>v.createOfferReducer),{tokenAmount:d}=l,{symbol:x,logoUrl:p,name:h}=l,{ticker:m,logoUrl:j,name:S}=a,[g,f]=react.exports.useState(!1),[b,F]=react.exports.useState(""),y=v=>v==null?void 0:v.filter(H=>H.name.toLowerCase().includes(b.toLowerCase())||H.address.toLowerCase()===b.toLowerCase()||H.symbol.toLowerCase()===b.toLowerCase()),R=()=>+o>0&&+o<=+d&&+c>0,u=y(e);return jsxs(Fragment,{children:[jsxs(Wrapper,{children:[jsx(ModalInput,{symbol:x,fullName:h,image:p,onOpen:()=>f(!g),label:"Crypto"}),jsx(Dropdown,{value:m,fullName:S,image:j,onAction:n,data:t,label:"Fiat"}),jsx(NumericalInput,{onUserInput:i,placeholder:"0",label:"Unit Price",element:m,value:c}),jsx(NumericalInput,{maxValue:d.toString(),onUserInput:s,placeholder:"0",label:"Quantity",element:x,value:o})]}),jsx("div",{className:"mt-5",children:jsx(Wrapper,{children:jsx(ButtonDisabled,{name:"Next",onClick:r,disabled:!R()})})}),g?jsxs(Modal,{close:()=>f(!1),header:"Select Token",children:[jsx(SearchField,{placeholder:"Enter token name or paste it address",setSearchTerm:F,searchTerm:b}),jsx(TokenList,{tokens:u,closeModal:()=>f(!1)})]}):null]})},TextArea=({value:e,label:t,placeholder:n,onAction:s})=>jsxs("div",{children:[jsx(Label,{label:t}),jsx("textarea",{spellCheck:!1,value:e,onChange:i=>s(i.target.value),placeholder:n,className:"p-3 w-full min-h-[200px] rounded-[15px] inputBorder"})]}),Payment=({payment:e,setActive:t,deletePayment:n})=>{const{bank:s,cardNumber:i,id:r}=e;return jsxs("button",{type:"button",onClick:()=>t(e),className:"flex justify-between items-center p-2 rounded-[15px] inputBorder w-full",children:[jsxs("div",{className:"flex items-center space-x-2",children:[jsx("img",{className:"w-8 h-8 rounded-full object-cover",src:s==null?void 0:s.logoUrl,alt:""}),jsx("span",{children:s==null?void 0:s.name}),jsx("span",{className:"font-bold",children:i})]}),jsx(CloseButton,{onAction:()=>n(r)})]})},CreateOfferStepTwo=()=>{const{addPaymentMethod:e,setRegion:t,setBank:n,prevStep:s,nextStep:i,updatePaymentMethod:r,removePaymentMethod:l}=useActions(),{fiat:a,region:o,bank:c,payMethods:d}=useTypedSelector(H=>H.createOfferReducer),[x,p]=react.exports.useState(""),[h,m]=react.exports.useState(""),j=()=>{const H={id:v4(),bank:c,region:o,cardNumber:h,paymentDescription:x};e(H),p(""),m("")},S=H=>{l(H),n(a.banks[0]),t(a.regions[0]),m(""),p("")},{banks:g,regions:f}=a,b=c==null?void 0:c.name,F=c==null?void 0:c.logoUrl,y=o==null?void 0:o.name,R=o==null?void 0:o.logoUrl,[u,v]=react.exports.useState(null),A=()=>{r({id:u==null?void 0:u.id,bank:c,region:o,cardNumber:h,paymentDescription:x}),m(""),p(""),v(null)};return react.exports.useEffect(()=>{u!=null&&(n(u==null?void 0:u.bank),t(u==null?void 0:u.region),m(u==null?void 0:u.cardNumber),p(u.paymentDescription))},[u]),jsxs(Fragment,{children:[jsxs(Wrapper,{children:[d.length?jsxs("div",{children:[jsx(Label,{label:"Payment Methods"}),jsx("div",{className:"flex flex-col gap-3",children:d.map(H=>jsx(Payment,{deletePayment:S,setActive:v,payment:H},H.id))})]}):null,jsxs("div",{children:[jsx(Label,{label:"Add Payment Method"}),jsxs("div",{className:"flex items-center gap-1",children:[jsx(Dropdown,{image:F,value:b,data:g,onAction:n}),jsx(Dropdown,{image:R,value:y,data:f,onAction:t})]})]}),jsx(NumericalInput,{value:h.replace(".",""),label:"Card Number",placeholder:"Enter card number",onUserInput:m}),jsx(TextArea,{value:x,onAction:p,label:"Payment Description",placeholder:"Here can be written something useful..."}),jsx(ButtonDisabled,{name:d.length===5?"Maximum":u!=null?"Save":"Add",onClick:u!=null?A:j,disabled:!(d.length<5)})]}),jsx("div",{className:"mt-5",children:jsx(Wrapper,{children:jsxs("div",{className:"flex gap-5",children:[jsx(ButtonDisabled,{onClick:s,disabled:!1,name:"Back"}),jsx(ButtonDisabled,{onClick:i,disabled:!(d.length>0),name:"Next"})]})})})]})},TimeLimit=({times:e,label:t,onAction:n})=>{const{timeLimit:s}=useTypedSelector(i=>i.createOfferReducer);return jsxs("div",{children:[jsx(Label,{label:t}),jsx("div",{className:"flex items-center justify-between p-5",children:e.map((i,r)=>jsx("button",{type:"button",onClick:()=>n(i),className:`${s===i?"text-purple":"text-gray"} font-bold cursor-pointer`,children:`${i} min`},r))})]})},CreateOfferStepThree=({handleCreateOffer:e})=>{const{setMinPriceLimit:t,setMaxPriceLimit:n,setTimeLimit:s,setComment:i,prevStep:r}=useActions(),{fiat:l,offerComment:a,minLimit:o,maxLimit:c,quantity:d,unitPrice:x}=useTypedSelector(m=>m.createOfferReducer),{ticker:p}=l,h=()=>!(+o>0&&+c>0&&+o<+c&&+c<=+d*+x);return jsxs(Fragment,{children:[jsxs(Wrapper,{children:[jsx(TimeLimit,{onAction:s,label:"Order Time Limit",times:["15","30","45","60","120"]}),jsx(Label,{label:"Order Price Limit"}),jsxs("div",{className:"flex justify-between gap-1",children:[jsx(NumericalInput,{value:o,onUserInput:t,placeholder:"Min",element:p}),jsx(NumericalInput,{value:c,maxValue:(+d*+x).toString(),onUserInput:n,placeholder:"Max",element:p})]}),jsx(TextArea,{value:a||"",onAction:i,label:"Comment",placeholder:"Enter comment"})]}),jsx("div",{className:"mt-5",children:jsx(Wrapper,{children:jsxs("div",{className:"flex gap-5",children:[jsx(ButtonDisabled,{onClick:r,name:"Back"}),jsx(ButtonDisabled,{disabled:h(),onClick:()=>e(),name:"Create"})]})})})]})},TokenService={async getTokens(e,t){return console.log("get tokens",t),await api.get(`/api/balance/${t}/${e}`)},async getExchangeRate(e){return console.log("get exchange rate",e),await api.get(`/api/balance/rate/${e}`)},async getEthUsdRate(e){return console.log("get eth usd rate",e),await coingeekoApi.get(`/api/v3/simple/price?ids=${e==="polygon"?"matic-network":"ethereum"}&vs_currencies=usd`)}},useTokens=()=>{const{chain:e}=useNetwork(),t=e==null?void 0:e.id.toString(),n=e==null?void 0:e.name.toLowerCase(),{setCrypto:s}=useActions(),{address:i}=useAccount(),{data:r,status:l}=useQuery([`get ${t} chain tokens`],()=>TokenService.getTokens(i,t),{select:f=>f.data.data,refetchOnWindowFocus:!1,refetchOnMount:!0}),{data:a,status:o}=useQuery([`get exchange ${t} token rate`],()=>TokenService.getExchangeRate(t),{select:f=>f.data.data,refetchInterval:6e4}),{data:c,status:d}=useQuery([`get ${n} usd rate`],()=>TokenService.getEthUsdRate(n),{select:f=>n==="polygon"?f.data["matic-network"].usd:f.data.ethereum.usd,refetchInterval:6e4}),x=d==="success"&&o==="success"&&l==="success",p=d==="loading"&&o==="loading"&&l==="loading",h=d==="error"&&o==="error"&&l==="error";react.exports.useEffect(()=>{x&&s(g[0])},[x]);const m=Zero,j=BigNumber.from(10).pow(36),S=BigNumber.from(10).pow(15),g=r==null?void 0:r.map(f=>{const b=BigNumber.from(f==null?void 0:f.balance);if(!b.eq(m)){const F=BigNumber.from(a[`${f==null?void 0:f.address}`]),y=BigNumber.from(parseInt(c)*100),R=b.mul(F).mul(y).div(j),u=parseInt(R.toString())/100,v=parseInt(b.div(S).toString())/1e3;return{...f,tokenAmount:v,balance:u}}return f});return{tokens:r,tokensSuccess:x,tokensLoading:p,tokensError:h}},useFiat=()=>{const{fiat:e}=useTypedSelector(d=>d.createOfferReducer),{regions:t,banks:n}=e,{setFiat:s,setBank:i,setRegion:r}=useActions(),{data:l,isSuccess:a,isError:o,isLoading:c}=useQuery(["get fiat"],()=>FiatServices.getFiat(),{select:d=>d.data.allFiat,onSuccess:d=>s(d[0]),refetchOnWindowFocus:!1});return react.exports.useEffect(()=>{a&&t.length!=0&&n.length!=0&&(i(l==null?void 0:l.filter(d=>d._id===e._id)[0].banks[0]),r(l==null?void 0:l.filter(d=>d._id===e._id)[0].regions[0]))},[e]),{allFiat:l,fiatSuccess:a,fiatError:o,fiatLoading:c}},ProgressBarStep=({step:e,name:t,currentStep:n})=>{const{step:s}=useTypedSelector(i=>i.createOfferReducer);return jsxs("div",{className:"flex items-center gap-x-2",children:[jsx("div",{className:`text-white h-[40px] w-[40px] rounded-[9999px] flex justify-center items-center font-bold ${e===s?"bg-purple":"bg-gray-200"} transition duration-300`,children:n+1}),jsx("div",{children:jsx("span",{className:`${e===s?"text-black":"text-gray-300"} transition duration-300 font-bold mb-2`,children:t})})]})},ProgressBar=({steps:e})=>jsx("div",{className:"bg-white flex justify-between rounded-[20px] p-5 shadow-customDark",children:e.map((t,n)=>{const{step:s,name:i}=t;return jsx(ProgressBarStep,{step:s,name:i,currentStep:n},n)})});var sha256={exports:{}};/**
 * [js-sha256]{@link https://github.com/emn178/js-sha256}
 *
 * @version 0.9.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */(function(module){(function(){var ERROR="input is invalid type",WINDOW=typeof window=="object",root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&typeof self=="object",NODE_JS=!root.JS_SHA256_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;NODE_JS?root={}:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&!0&&module.exports,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];(root.JS_SHA256_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),ARRAY_BUFFER&&(root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(e){return typeof e=="object"&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(n){return new Sha256(t,!0).update(n)[e]()}},createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(i){return t.create().update(i)};for(var n=0;n<OUTPUT_TYPES.length;++n){var s=OUTPUT_TYPES[n];t[s]=createOutputMethod(s,e)}return t},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if(typeof e=="string")return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(e==null)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},createHmacOutputMethod=function(e,t){return function(n,s){return new HmacSha256(n,t,!0).update(s)[e]()}},createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(i){return new HmacSha256(i,e)},t.update=function(i,r){return t.create(i).update(r)};for(var n=0;n<OUTPUT_TYPES.length;++n){var s=OUTPUT_TYPES[n];t[s]=createHmacOutputMethod(s,e)}return t};function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}Sha256.prototype.update=function(e){if(!this.finalized){var t,n=typeof e;if(n!=="string"){if(n==="object"){if(e===null)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw new Error(ERROR)}else throw new Error(ERROR);t=!0}for(var s,i=0,r,l=e.length,a=this.blocks;i<l;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)for(r=this.start;i<l&&r<64;++i)a[r>>2]|=e[i]<<SHIFT[r++&3];else for(r=this.start;i<l&&r<64;++i)s=e.charCodeAt(i),s<128?a[r>>2]|=s<<SHIFT[r++&3]:s<2048?(a[r>>2]|=(192|s>>6)<<SHIFT[r++&3],a[r>>2]|=(128|s&63)<<SHIFT[r++&3]):s<55296||s>=57344?(a[r>>2]|=(224|s>>12)<<SHIFT[r++&3],a[r>>2]|=(128|s>>6&63)<<SHIFT[r++&3],a[r>>2]|=(128|s&63)<<SHIFT[r++&3]):(s=65536+((s&1023)<<10|e.charCodeAt(++i)&1023),a[r>>2]|=(240|s>>18)<<SHIFT[r++&3],a[r>>2]|=(128|s>>12&63)<<SHIFT[r++&3],a[r>>2]|=(128|s>>6&63)<<SHIFT[r++&3],a[r>>2]|=(128|s&63)<<SHIFT[r++&3]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=a[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[t&3],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e=this.h0,t=this.h1,n=this.h2,s=this.h3,i=this.h4,r=this.h5,l=this.h6,a=this.h7,o=this.blocks,c,d,x,p,h,m,j,S,g,f,b;for(c=16;c<64;++c)h=o[c-15],d=(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3,h=o[c-2],x=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10,o[c]=o[c-16]+d+o[c-7]+x<<0;for(b=t&n,c=0;c<64;c+=4)this.first?(this.is224?(S=300032,h=o[0]-1413257819,a=h-150054599<<0,s=h+24177077<<0):(S=704751109,h=o[0]-210244248,a=h-1521486534<<0,s=h+143694565<<0),this.first=!1):(d=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),x=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),S=e&t,p=S^e&n^b,j=i&r^~i&l,h=a+x+j+K[c]+o[c],m=d+p,a=s+h<<0,s=h+m<<0),d=(s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10),x=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),g=s&e,p=g^s&t^S,j=a&i^~a&r,h=l+x+j+K[c+1]+o[c+1],m=d+p,l=n+h<<0,n=h+m<<0,d=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),x=(l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7),f=n&s,p=f^n&e^g,j=l&a^~l&i,h=r+x+j+K[c+2]+o[c+2],m=d+p,r=t+h<<0,t=h+m<<0,d=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),x=(r>>>6|r<<26)^(r>>>11|r<<21)^(r>>>25|r<<7),b=t&n,p=b^t&s^f,j=r&l^~r&a,h=i+x+j+K[c+3]+o[c+3],m=d+p,i=e+h<<0,e=h+m<<0;this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+n<<0,this.h3=this.h3+s<<0,this.h4=this.h4+i<<0,this.h5=this.h5+r<<0,this.h6=this.h6+l<<0,this.h7=this.h7+a<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,s=this.h3,i=this.h4,r=this.h5,l=this.h6,a=this.h7,o=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[e&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[t&15]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[n&15]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[s&15]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[i&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[r&15]+HEX_CHARS[l>>28&15]+HEX_CHARS[l>>24&15]+HEX_CHARS[l>>20&15]+HEX_CHARS[l>>16&15]+HEX_CHARS[l>>12&15]+HEX_CHARS[l>>8&15]+HEX_CHARS[l>>4&15]+HEX_CHARS[l&15];return this.is224||(o+=HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[a&15]),o},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,s=this.h3,i=this.h4,r=this.h5,l=this.h6,a=this.h7,o=[e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255,i>>24&255,i>>16&255,i>>8&255,i&255,r>>24&255,r>>16&255,r>>8&255,r&255,l>>24&255,l>>16&255,l>>8&255,l&255];return this.is224||o.push(a>>24&255,a>>16&255,a>>8&255,a&255),o},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e};function HmacSha256(e,t,n){var s,i=typeof e;if(i==="string"){var r=[],l=e.length,a=0,o;for(s=0;s<l;++s)o=e.charCodeAt(s),o<128?r[a++]=o:o<2048?(r[a++]=192|o>>6,r[a++]=128|o&63):o<55296||o>=57344?(r[a++]=224|o>>12,r[a++]=128|o>>6&63,r[a++]=128|o&63):(o=65536+((o&1023)<<10|e.charCodeAt(++s)&1023),r[a++]=240|o>>18,r[a++]=128|o>>12&63,r[a++]=128|o>>6&63,r[a++]=128|o&63);e=r}else if(i==="object"){if(e===null)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw new Error(ERROR)}else throw new Error(ERROR);e.length>64&&(e=new Sha256(t,!0).update(e).array());var c=[],d=[];for(s=0;s<64;++s){var x=e[s]||0;c[s]=92^x,d[s]=54^x}Sha256.call(this,t,n),this.update(d),this.oKeyPad=c,this.inner=!0,this.sharedMemory=n}HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224)})()})(sha256);const useGenerateRoom=()=>{const{address:e}=useAccount(),[t,n]=react.exports.useState();return react.exports.useEffect(()=>{n(BigNumber.from("0x"+sha256.exports.sha256(Date.now().toString()+e).slice(0,40)))},[]),{roomId:t}},useCreateRoom=()=>{const{quantity:e,unitPrice:t,timeLimit:n,minLimit:s,maxLimit:i,crypto:r,fiat:l,offerComment:a,payMethods:o}=useTypedSelector(u=>u.createOfferReducer),c=useNavigate(),{resetOffer:d}=useActions(),{roomId:x}=useGenerateRoom(),p=(u,v)=>{if(u!="."&&u!="0"&&u!=null)try{return parseEther(u.toString()).div(BigNumber.from(v))}catch(A){console.log(A)}},h=[x,+n*60,p(i.toString(),+t),p(s.toString(),+t),"0x0000000000000000000000000000000000000000",parseEther("0"),t],{config:m,status:j}=usePrepareContractWrite({...contractConfig,functionName:"createRoom",args:h,overrides:{value:parseEther(+e>0?e.toString():"0"),gasLimit:BigNumber.from(4e5)}}),{data:S,status:g,writeAsync:f}=useContractWrite(m),{isSuccess:b,isLoading:F,data:y}=useWaitForTransaction({hash:S==null?void 0:S.hash});return{data:S,handleCreateOffer:async()=>{f==null||f().then(()=>{OfferService.create({offerType:"buy",payMethods:o.map(u=>{const{bank:v,cardNumber:A,region:H,paymentDescription:N}=u;return{bank:v,cardNumber:A,region:H,paymentDescription:N}}),fiat:l._id,roomId:x.toString(),unitPrice:t,amount:+t*+e,quantity:e,minLimit:s,maxLimit:i,crypto:r._id,offerComment:a}).then(()=>{Q.success("Offer is created",{position:Q.POSITION.BOTTOM_RIGHT}),c("/"),d()}).catch(u=>Q.error(u,{position:Q.POSITION.BOTTOM_RIGHT}))})},isSuccess:b,isLoading:F,hash:y,prepareTxStatus:j,txStatus:g}},SkeletonThemeContext=React.createContext({}),defaultEnableAnimation=!0;function styleOptionsToCssProperties({baseColor:e,highlightColor:t,width:n,height:s,borderRadius:i,circle:r,direction:l,duration:a,enableAnimation:o=defaultEnableAnimation}){const c={};return l==="rtl"&&(c["--animation-direction"]="reverse"),typeof a=="number"&&(c["--animation-duration"]=`${a}s`),o||(c["--pseudo-element-display"]="none"),(typeof n=="string"||typeof n=="number")&&(c.width=n),(typeof s=="string"||typeof s=="number")&&(c.height=s),(typeof i=="string"||typeof i=="number")&&(c.borderRadius=i),r&&(c.borderRadius="50%"),typeof e<"u"&&(c["--base-color"]=e),typeof t<"u"&&(c["--highlight-color"]=t),c}function Skeleton({count:e=1,wrapper:t,className:n,containerClassName:s,containerTestId:i,circle:r=!1,style:l,...a}){var o,c,d;const x=React.useContext(SkeletonThemeContext),p={...a};for(const[b,F]of Object.entries(a))typeof F>"u"&&delete p[b];const h={...x,...p,circle:r},m={...l,...styleOptionsToCssProperties(h)};let j="react-loading-skeleton";n&&(j+=` ${n}`);const S=(o=h.inline)!==null&&o!==void 0?o:!1,g=[],f=Math.ceil(e);for(let b=0;b<f;b++){let F=m;if(f>e&&b===f-1){const R=(c=F.width)!==null&&c!==void 0?c:"100%",u=e%1,v=typeof R=="number"?R*u:`calc(${R} * ${u})`;F={...F,width:v}}const y=jsx("span",{className:j,style:F,children:"\u200C"},b);S?g.push(y):g.push(jsxs(Fragment,{children:[y,jsx("br",{})]}))}return jsx("span",{className:s,"data-testid":i,"aria-live":"polite","aria-busy":(d=h.enableAnimation)!==null&&d!==void 0?d:defaultEnableAnimation,children:t?g.map((b,F)=>jsx(t,{children:b},F)):g})}const SkeletonWrapper=({children:e,isLoaded:t,height:n,count:s,margin:i})=>t?e:jsx(Skeleton,{height:n,borderRadius:20,count:s,style:{marginBottom:i}}),CreateOfferPage=()=>{const{data:e,handleCreateOffer:t,isSuccess:n,isLoading:s,hash:i,prepareTxStatus:r,txStatus:l}=useCreateRoom(),{step:a}=useTypedSelector(b=>b.createOfferReducer),{tokens:o,tokensError:c,tokensLoading:d,tokensSuccess:x}=useTokens(),{allFiat:p,fiatSuccess:h,fiatError:m,fiatLoading:j}=useFiat(),S=x&&h;return jsx(ErrorBoundary,{fallback:jsx("h1",{children:"error"}),children:jsxs("div",{className:"p-5",children:[jsx(ProgressBar,{steps:[{step:1,name:"Offer Price"},{step:2,name:"Payment Method"},{step:3,name:"Settings"}]}),jsxs("div",{className:"grid grid-cols-2 gap-5 mt-5",children:[jsx("div",{children:jsx(ErrorBoundary,{fallback:jsx("h1",{children:"error"}),children:jsx(SkeletonWrapper,{isLoaded:S,height:600,children:jsx("div",{className:"flex flex-col gap-5",children:(()=>{switch(a){case 1:return jsx(CreateOfferStepOne,{tokens:o,allFiat:p});case 2:return jsx(CreateOfferStepTwo,{});case 3:return jsx(CreateOfferStepThree,{handleCreateOffer:t});default:return}})()})})})}),jsx("div",{children:jsx(SkeletonWrapper,{isLoaded:S,height:600,children:jsx(Preview,{})})})]})]})})};export{CreateOfferPage as default};
