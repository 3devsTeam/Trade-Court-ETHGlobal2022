import{a as o,j as h,z as Ae,l as Ce,F as R,B as D,m as Y,o as K,n as z,D as Te,g as Re,E as _e,O as _}from"./index.d4f6898f.js";import{u as N,a as re,v as Se,E as F}from"./react-error-boundary.esm.84b5157a.js";const Oe="/assets/ava.73445bf0.svg",Be=({color:s})=>o("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o("path",{d:"M29.42 0.245268C28.9746 -0.056841 28.3988 -0.082505 27.9279 0.182983L0.710867 15.6504C0.245403 15.9199 -0.0295416 16.4238 0.00252948 16.957C0.0346064 17.4917 0.368168 17.9625 0.862372 18.1693L9.85376 21.9416V28.592C9.85376 29.1065 10.1351 29.5787 10.5869 29.826C10.7979 29.9414 11.0266 30 11.2085 30C11.4733 30 11.7385 29.9249 11.9703 29.7766L18.4925 25.5895L24.2732 28.0153C24.4483 28.0886 24.6334 28.1252 24.8185 28.1252C25.0577 28.1252 25.296 28.0648 25.5095 27.9439C25.8879 27.7315 26.1476 27.3544 26.2104 26.9255L29.9641 1.61302C30.0945 1.08046 29.8599 0.549194 29.42 0.245268ZM21.6603 6.98437L10.6864 19.2246L4.58837 16.6816L21.6603 6.98437ZM12.6161 26.0156V23.1234L15.3405 24.2666L12.6161 26.0156ZM23.7424 24.7207L13.3844 20.3736L26.5577 5.75449L23.7424 24.7207Z",className:`active:fill-${s} active:scale-105 transition-all duration-500`,fill:"#C6C6C6"})}),Le=({chatMessages:s,addressOrName:e,avatar:t,message:n,setMessage:r,sendMessage:i})=>h("div",{className:"bg-white rounded-[20px] relative shadow-customDark",children:[o("div",{className:"bg-purple rounded-t-[20px] h-[70px] px-[18px] flex items-center",children:h("div",{className:"flex items-center gap-2",children:[o("img",{className:"rounded-[50%]",src:t||Oe,width:55,height:55,alt:""}),h("div",{className:"flex flex-col justify-start",children:[o("span",{className:"text-white font-bold",children:Ae(e)}),o("span",{className:"text-white text-sm",children:"online"})]})]})}),o("div",{className:"h-52",children:s}),h("div",{className:"flex absolute bottom-0 items-center border-t-2 border-gray pr-5 w-full",children:[o("input",{onChange:a=>r(a.target.value),className:"h-[70px] rounded-b-[20px] pl-5 w-full outline-none font-bold text-sm",placeholder:"Type some message..."}),o("button",{className:"",onClick:()=>i(n),children:o(Be,{color:"purple"})})]})]}),Pe=({makerConfirmed:s})=>{const{step:e}=N(n=>n.transactionReducer),t=Ce();return h(R,{children:[e===1||e===2?o(D,{name:"Funds recieved",onClick:()=>s(),disabled:e===1}):null,e===3?o(D,{name:"Go to Home page",onClick:()=>t("/"),color:"bg-purple"}):null]})},De=({takerConfirmed:s,takerClaim:e})=>{const{step:t}=N(n=>n.transactionReducer);return h(R,{children:[t===1?o(D,{onClick:()=>s(),name:"Done",color:"bg-purple"}):null,t===2?o("span",{className:"text-xl font-bold",children:"Wating for confirmation..."}):null,t===3?o(D,{onClick:()=>e(),name:"Claim",color:"bg-purple"}):null]})},Me=({id:s,time:e})=>{const t=new Date(e);return h("div",{className:"flex flex-col font-bold",children:[h("span",{children:["Created at: ",(r=>`${r.getMonth()<10?`0${r.getMonth()}`:r.getMonth()}.${r.getDate()<10?`0${r.getDate()}`:r.getDate()}.${r.getFullYear()} ${r.getHours()<10?`0${r.getHours()}`:r.getHours()}:${r.getMinutes()<10?`0${r.getMinutes()}`:r.getMinutes()}:${r.getSeconds()<10?`0${r.getSeconds()}`:r.getSeconds()}`)(t)]}),h("span",{children:["Order number: ",s]})]})},Ie=({offer:s})=>h("div",{className:"flex justify-between items-center p-5 font-bold wrapper",children:[h("div",{className:"flex flex-col",children:[h("span",{children:["You send: ",s==null?void 0:s.crypto.symbol]}),h("span",{children:["You send: ",s.fiat.ticker]})]}),o("div",{children:h("span",{children:["Amount: ",s==null?void 0:s.totalAmount," ",s==null?void 0:s.fiat.ticker]})}),o("div",{children:h("span",{children:["Unit Price: ",s==null?void 0:s.unitPrice," ",s==null?void 0:s.fiat.ticker]})}),h("div",{children:["Quantity: ",s==null?void 0:s.totalQuantity," ",s==null?void 0:s.crypto.symbol]})]}),qe=({amount:s})=>h("div",{className:"h-[40vh] flex justify-center items-center text-center font-bold text-xl",children:["Payment sent ",o("br",{})," Please, comfirm if funds are recieved ",o("br",{})," You should recieve: ",s," ","RUB"]}),Fe="/assets/confeti.6cb7aaa7.png",Ve="/assets/good.b9990982.png",Ue="/assets/neutral.13177871.png",We="/assets/bad.cf6adbca.png",ie=()=>o("div",{children:o("div",{className:"flex justify-center items-center h-[400px]",children:h("div",{className:"flex flex-col items-center gap-2",children:[h("div",{className:"flex text-2xl gap-2 mb-[20px]",children:[o("span",{className:"font-bold",children:"Success"}),o("img",{src:Fe,height:40,width:40})]}),o("span",{className:"font-bold text-lg",children:"How was it?"}),h("div",{className:"flex items-center gap-4",children:[o("img",{src:We,height:40,width:40,className:"hover:scale-110 transition-transform duration-300 cursor-pointer"}),o("img",{src:Ue,height:40,width:40,className:"hover:scale-110 transition-transform duration-300 cursor-pointer"}),o("img",{src:Ve,height:40,width:40,className:"hover:scale-110 transition-transform duration-300 cursor-pointer"})]})]})})}),He=()=>o("div",{className:"h-[40vh] flex justify-center items-center font-bold text-xl",children:"Waiting for other user transaction"}),$e=({offer:s})=>{const{step:e}=N(t=>t.transactionReducer);return h(R,{children:[e===1?o(He,{}):null,e===2?o(qe,{amount:s==null?void 0:s.amount,fiat:s==null?void 0:s.fiat.name}):null,e===3?o(ie,{}):null]})},Ye=({payment:s})=>{var t,n;const{setSelectedPayment:e}=re();return h("button",{onClick:()=>e(s),className:"flex items-center p-[10px] rounded-[15px] border font-bold inputBorder",children:[o("img",{src:(t=s==null?void 0:s.bank)==null?void 0:t.logoUrl,className:"w-8 h-8"}),(n=s==null?void 0:s.bank)==null?void 0:n.name]})},Ke=()=>o("div",{className:"bg-yellow rounded-[15px] px-[20px] py-[10px] font-bold",children:h("p",{className:"text-sm",children:["Please check payment info twice before sending transaction.",o("br",{}),"Tradecourt are not responsible for lost transactions."]})}),ze=({payMethods:s})=>{const{selectedPayment:e}=N(a=>a.transactionReducer),{cardNumber:t,region:n,bank:r,paymentDescription:i}=e;return h("div",{children:[o("div",{className:"flex space-x-2 items-center overflow-x-auto mb-4",children:s.map(a=>o(Ye,{payment:a},Se()))}),h("div",{className:"flex flex-col gap-y-[10px] font-bold",children:[h("div",{className:"flex flex-col",children:[o("span",{className:"text-gray-300 text-xs",children:"Bank"}),o("span",{children:r==null?void 0:r.name})]}),h("div",{className:"flex flex-col",children:[o("span",{className:"text-gray-300 text-xs",children:"Region"}),o("span",{children:n.name})]}),h("div",{className:"flex flex-col",children:[o("span",{className:"text-gray-300 text-xs",children:"Card Number"}),o("span",{children:t})]}),i?h("div",{className:"flex flex-col",children:[o("span",{className:"text-gray-300 text-xs",children:"Payment Description"}),o("span",{children:i})]}):null,o(Ke,{})]})]})},Je=({offer:s})=>{const{step:e}=N(t=>t.transactionReducer);return h(R,{children:[e===1||e===2?o(ze,{payMethods:s.payMethods}):null,e===3?o(ie,{}):null]})};var C=(s=>(s.taker="taker",s.maker="maker",s))(C||{});const g=Object.create(null);g.open="0";g.close="1";g.ping="2";g.pong="3";g.message="4";g.upgrade="5";g.noop="6";const B=Object.create(null);Object.keys(g).forEach(s=>{B[g[s]]=s});const Xe={type:"error",data:"parser error"},je=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Qe=typeof ArrayBuffer=="function",Ze=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s&&s.buffer instanceof ArrayBuffer,oe=({type:s,data:e},t,n)=>je&&e instanceof Blob?t?n(e):j(e,n):Qe&&(e instanceof ArrayBuffer||Ze(e))?t?n(e):j(new Blob([e]),n):n(g[s]+(e||"")),j=(s,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+n)},t.readAsDataURL(s)},Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let s=0;s<Q.length;s++)T[Q.charCodeAt(s)]=s;const Ge=s=>{let e=s.length*.75,t=s.length,n,r=0,i,a,c,f;s[s.length-1]==="="&&(e--,s[s.length-2]==="="&&e--);const k=new ArrayBuffer(e),b=new Uint8Array(k);for(n=0;n<t;n+=4)i=T[s.charCodeAt(n)],a=T[s.charCodeAt(n+1)],c=T[s.charCodeAt(n+2)],f=T[s.charCodeAt(n+3)],b[r++]=i<<2|a>>4,b[r++]=(a&15)<<4|c>>2,b[r++]=(c&3)<<6|f&63;return k},et=typeof ArrayBuffer=="function",ae=(s,e)=>{if(typeof s!="string")return{type:"message",data:ce(s,e)};const t=s.charAt(0);return t==="b"?{type:"message",data:tt(s.substring(1),e)}:B[t]?s.length>1?{type:B[t],data:s.substring(1)}:{type:B[t]}:Xe},tt=(s,e)=>{if(et){const t=Ge(s);return ce(t,e)}else return{base64:!0,data:s}},ce=(s,e)=>{switch(e){case"blob":return s instanceof ArrayBuffer?new Blob([s]):s;case"arraybuffer":default:return s}},he=String.fromCharCode(30),st=(s,e)=>{const t=s.length,n=new Array(t);let r=0;s.forEach((i,a)=>{oe(i,!1,c=>{n[a]=c,++r===t&&e(n.join(he))})})},nt=(s,e)=>{const t=s.split(he),n=[];for(let r=0;r<t.length;r++){const i=ae(t[r],e);if(n.push(i),i.type==="error")break}return n},le=4;function u(s){if(s)return rt(s)}function rt(s){for(var e in u.prototype)s[e]=u.prototype[e];return s}u.prototype.on=u.prototype.addEventListener=function(s,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(e),this};u.prototype.once=function(s,e){function t(){this.off(s,t),e.apply(this,arguments)}return t.fn=e,this.on(s,t),this};u.prototype.off=u.prototype.removeListener=u.prototype.removeAllListeners=u.prototype.removeEventListener=function(s,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+s];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var n,r=0;r<t.length;r++)if(n=t[r],n===e||n.fn===e){t.splice(r,1);break}return t.length===0&&delete this._callbacks["$"+s],this};u.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+s],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,r=t.length;n<r;++n)t[n].apply(this,e)}return this};u.prototype.emitReserved=u.prototype.emit;u.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};u.prototype.hasListeners=function(s){return!!this.listeners(s).length};const w=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function ue(s,...e){return e.reduce((t,n)=>(s.hasOwnProperty(n)&&(t[n]=s[n]),t),{})}const it=setTimeout,ot=clearTimeout;function M(s,e){e.useNativeTimers?(s.setTimeoutFn=it.bind(w),s.clearTimeoutFn=ot.bind(w)):(s.setTimeoutFn=setTimeout.bind(w),s.clearTimeoutFn=clearTimeout.bind(w))}const at=1.33;function ct(s){return typeof s=="string"?ht(s):Math.ceil((s.byteLength||s.size)*at)}function ht(s){let e=0,t=0;for(let n=0,r=s.length;n<r;n++)e=s.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}class lt extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class fe extends u{constructor(e){super(),this.writable=!1,M(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new lt(e,t,n)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=ae(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const de="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),V=64,ut={};let Z=0,S=0,G;function ee(s){let e="";do e=de[s%V]+e,s=Math.floor(s/V);while(s>0);return e}function pe(){const s=ee(+new Date);return s!==G?(Z=0,G=s):s+"."+ee(Z++)}for(;S<V;S++)ut[de[S]]=S;function me(s){let e="";for(let t in s)s.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(s[t]));return e}function ft(s){let e={},t=s.split("&");for(let n=0,r=t.length;n<r;n++){let i=t[n].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}let ge=!1;try{ge=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch(s){}const dt=ge;function ye(s){const e=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||dt))return new XMLHttpRequest}catch(t){}if(!e)try{return new w[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function pt(){}const mt=function(){return new ye({xdomain:!1}).responseType!=null}();class gt extends fe{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==n}const t=e&&e.forceBase64;this.supportsBinary=mt&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};nt(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,st(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=pe()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);const r=me(e),i=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new m(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(r,i)=>{this.onError("xhr post error",r,i)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class m extends u{constructor(e,t){super(),M(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=ue(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new ye(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch(n){}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{t.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document<"u"&&(this.index=m.requestsCount++,m.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=pt,e)try{this.xhr.abort()}catch(t){}typeof document<"u"&&delete m.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}m.requestsCount=0;m.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",te);else if(typeof addEventListener=="function"){const s="onpagehide"in w?"pagehide":"unload";addEventListener(s,te,!1)}}function te(){for(let s in m.requests)m.requests.hasOwnProperty(s)&&m.requests[s].abort()}const be=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),O=w.WebSocket||w.MozWebSocket,se=!0,yt="arraybuffer",ne=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class bt extends fe{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=ne?{}:ue(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=se&&!ne?t?new O(e,t):new O(e):new O(e,t,n)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType||yt,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;oe(n,this.supportsBinary,i=>{const a={};try{se&&this.ws.send(i)}catch(c){}r&&be(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=pe()),this.supportsBinary||(e.b64=1);const r=me(e),i=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}check(){return!!O}}const vt={websocket:bt,polling:gt},wt=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,kt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function U(s){const e=s,t=s.indexOf("["),n=s.indexOf("]");t!=-1&&n!=-1&&(s=s.substring(0,t)+s.substring(t,n).replace(/:/g,";")+s.substring(n,s.length));let r=wt.exec(s||""),i={},a=14;for(;a--;)i[kt[a]]=r[a]||"";return t!=-1&&n!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=xt(i,i.path),i.queryKey=Nt(i,i.query),i}function xt(s,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Nt(s,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,r,i){r&&(t[r]=i)}),t}class v extends u{constructor(e,t={}){super(),e&&typeof e=="object"&&(t=e,e=null),e?(e=U(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=U(t.host).host),M(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=ft(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=le,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new vt[e](n)}open(){let e;if(this.opts.rememberUpgrade&&v.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(t){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;v.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",x=>{if(!n)if(x.type==="pong"&&x.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;v.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(b(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function i(){n||(n=!0,b(),t.close(),t=null)}const a=x=>{const y=new Error("probe error: "+x);y.transport=t.name,i(),this.emitReserved("upgradeError",y)};function c(){a("transport closed")}function f(){a("socket closed")}function k(x){t&&x.name!==t.name&&i()}const b=()=>{t.removeListener("open",r),t.removeListener("error",a),t.removeListener("close",c),this.off("close",f),this.off("upgrading",k)};t.once("open",r),t.once("error",a),t.once("close",c),this.once("close",f),this.once("upgrading",k),t.open()}onOpen(){if(this.readyState="open",v.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(t+=ct(r)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){if(typeof t=="function"&&(r=t,t=void 0),typeof n=="function"&&(r=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){v.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}v.protocol=le;function Et(s,e="",t){let n=s;t=t||typeof location<"u"&&location,s==null&&(s=t.protocol+"//"+t.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=t.protocol+s:s=t.host+s),/^(https?|wss?):\/\//.test(s)||(typeof t<"u"?s=t.protocol+"//"+s:s="https://"+s),n=U(s)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const i=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+e,n.href=n.protocol+"://"+i+(t&&t.port===n.port?"":":"+n.port),n}const At=typeof ArrayBuffer=="function",Ct=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,ve=Object.prototype.toString,Tt=typeof Blob=="function"||typeof Blob<"u"&&ve.call(Blob)==="[object BlobConstructor]",Rt=typeof File=="function"||typeof File<"u"&&ve.call(File)==="[object FileConstructor]";function J(s){return At&&(s instanceof ArrayBuffer||Ct(s))||Tt&&s instanceof Blob||Rt&&s instanceof File}function L(s,e){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let t=0,n=s.length;t<n;t++)if(L(s[t]))return!0;return!1}if(J(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return L(s.toJSON(),!0);for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&L(s[t]))return!0;return!1}function _t(s){const e=[],t=s.data,n=s;return n.data=W(t,e),n.attachments=e.length,{packet:n,buffers:e}}function W(s,e){if(!s)return s;if(J(s)){const t={_placeholder:!0,num:e.length};return e.push(s),t}else if(Array.isArray(s)){const t=new Array(s.length);for(let n=0;n<s.length;n++)t[n]=W(s[n],e);return t}else if(typeof s=="object"&&!(s instanceof Date)){const t={};for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=W(s[n],e));return t}return s}function St(s,e){return s.data=H(s.data,e),s.attachments=void 0,s}function H(s,e){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<e.length)return e[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let t=0;t<s.length;t++)s[t]=H(s[t],e);else if(typeof s=="object")for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&(s[t]=H(s[t],e));return s}const Ot=5;var l;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(l||(l={}));class Bt{constructor(e){this.replacer=e}encode(e){return(e.type===l.EVENT||e.type===l.ACK)&&L(e)?(e.type=e.type===l.EVENT?l.BINARY_EVENT:l.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===l.BINARY_EVENT||e.type===l.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=_t(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}class X extends u{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e),t.type===l.BINARY_EVENT||t.type===l.BINARY_ACK?(this.reconstructor=new Lt(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(J(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(l[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===l.BINARY_EVENT||n.type===l.BINARY_ACK){const i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const a=e.substring(i,t);if(a!=Number(a)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(a)}if(e.charAt(t+1)==="/"){const i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(i,t)}else n.nsp="/";const r=e.charAt(t+1);if(r!==""&&Number(r)==r){const i=t+1;for(;++t;){const a=e.charAt(t);if(a==null||Number(a)!=a){--t;break}if(t===e.length)break}n.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(X.isPayloadValid(n.type,i))n.data=i;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case l.CONNECT:return typeof t=="object";case l.DISCONNECT:return t===void 0;case l.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case l.EVENT:case l.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case l.ACK:case l.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Lt{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=St(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Pt=Object.freeze(Object.defineProperty({__proto__:null,protocol:Ot,get PacketType(){return l},Encoder:Bt,Decoder:X},Symbol.toStringTag,{value:"Module"}));function p(s,e,t){return s.on(e,t),function(){s.off(e,t)}}const Dt=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class we extends u{constructor(e,t,n){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[p(e,"open",this.onopen.bind(this)),p(e,"packet",this.onpacket.bind(this)),p(e,"error",this.onerror.bind(this)),p(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Dt.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');t.unshift(e);const n={type:l.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const a=this.ids++,c=t.pop();this._registerAckCallback(a,c),n.id=a}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){const n=this.flags.timeout;if(n===void 0){this.acks[e]=t;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===e&&this.sendBuffer.splice(i,1);t.call(this,new Error("operation has timed out"))},n);this.acks[e]=(...i)=>{this.io.clearTimeoutFn(r),t.apply(this,[null,...i])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:l.CONNECT,data:e})}):this.packet({type:l.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case l.CONNECT:if(e.data&&e.data.sid){const r=e.data.sid;this.onconnect(r)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case l.EVENT:case l.BINARY_EVENT:this.onevent(e);break;case l.ACK:case l.BINARY_ACK:this.onack(e);break;case l.DISCONNECT:this.ondisconnect();break;case l.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let n=!1;return function(...r){n||(n=!0,t.packet({type:l.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:l.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function E(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}E.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*s);s=(Math.floor(e*10)&1)==0?s-t:s+t}return Math.min(s,this.max)|0};E.prototype.reset=function(){this.attempts=0};E.prototype.setMin=function(s){this.ms=s};E.prototype.setMax=function(s){this.max=s};E.prototype.setJitter=function(s){this.jitter=s};class $ extends u{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,M(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new E({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||Pt;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new v(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=p(t,"open",function(){n.onopen(),e&&e()}),i=p(t,"error",a=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",a),e?e(a):n.maybeReconnectOnOpen()});if(this._timeout!==!1){const a=this._timeout;a===0&&r();const c=this.setTimeoutFn(()=>{r(),t.close(),t.emit("error",new Error("timeout"))},a);this.opts.autoUnref&&c.unref(),this.subs.push(function(){clearTimeout(c)})}return this.subs.push(r),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(p(e,"ping",this.onping.bind(this)),p(e,"data",this.ondata.bind(this)),p(e,"error",this.onerror.bind(this)),p(e,"close",this.onclose.bind(this)),p(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){be(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n||(n=new we(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const A={};function P(s,e){typeof s=="object"&&(e=s,s=void 0),e=e||{};const t=Et(s,e.path||"/socket.io"),n=t.source,r=t.id,i=t.path,a=A[r]&&i in A[r].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||a;let f;return c?f=new $(n,e):(A[r]||(A[r]=new $(n,e)),f=A[r]),t.query&&!e.query&&(e.query=t.queryKey),f.socket(t.path,e)}Object.assign(P,{Manager:$,Socket:we,io:P,connect:P});const Mt=(s,e)=>{const t=[s,e],{config:n,status:r}=Y({...z,functionName:"takerApprove",args:t}),{data:i,status:a,writeAsync:c}=K(n);return{data:i,prepareTxStatus:r,contractTxStatus:a,takerApprove:c}},It=(s,e)=>{const t=[s,e],{config:n,status:r}=Y({...z,functionName:"makerApprove",args:t}),{data:i,status:a,writeAsync:c}=K(n);return{data:i,makerApprove:c,makerPrepareTxStatus:r,makerContractTxStatus:a}},qt=(s,e)=>{const t=[s,e],{config:n,status:r}=Y({...z,functionName:"takerWithdraw",args:t}),{data:i,status:a,writeAsync:c}=K(n);return{takerWithdrawTxData:i,takerWithdrawPrepareTxStatus:r,takerWithdrawTxStatus:a,takerWithdraw:c}},Xt=()=>{const s=P("http://127.0.0.1:3030");s.on("approvalStage",()=>{i(2)}),s.on("successStage",()=>{i(3)});const{id:e}=Te(),{address:t}=Re(),{setSelectedPayment:n,setRole:r,setStep:i}=re(),{role:a}=N(d=>d.transactionReducer),{data:c,isLoading:f,isSuccess:k,isError:b}=_e(["get offer by id"],()=>_.getByID(e),{select:({data:d})=>d.data.room,onSuccess:d=>{r(d.role),ke({id:e,role:a}),i(d.stage==="waiting taker"?1:d.stage==="taker send"?2:d.stage==="maker recieved"?3:null),n(d.offer.payMethods[0])}}),{data:x,takerApprove:y,prepareTxStatus:Ft,contractTxStatus:Vt}=Mt(c==null?void 0:c.offer.roomId,c==null?void 0:c.takerNumber),{data:Ut,makerApprove:I,makerContractTxStatus:Wt,makerPrepareTxStatus:Ht}=It(c==null?void 0:c.offer.roomId,c==null?void 0:c.takerNumber),{takerWithdraw:q,takerWithdrawPrepareTxStatus:$t,takerWithdrawTxData:Yt,takerWithdrawTxStatus:Kt}=qt(c==null?void 0:c.offer.roomId,c==null?void 0:c.takerNumber),ke=d=>{s.emit("joinOffer",d)},xe=async()=>{await(y==null?void 0:y()),await _.takerSend(e),s.emit("takerConfirmed",e)},Ne=async()=>{await(I==null?void 0:I()),await _.makerRecieved(e),s.emit("makerConfirmed",e)},Ee=async()=>{await(q==null?void 0:q()),await _.claimByID(e)};return k?h(R,{children:[o(Ie,{offer:c==null?void 0:c.offer}),h("div",{className:"grid grid-cols-form gap-5 mt-5",children:[h("div",{children:[o("div",{className:"wrapper p-5",children:h(F,{fallback:o("h1",{children:"error"}),children:[a===C.taker?o(Je,{offer:c.offer}):null,a===C.maker?o($e,{offer:c.offer}):null,o(Me,{id:c._id,time:c.createdAt})]})}),o("div",{className:"wrapper p-5 mt-5",children:h(F,{fallback:o("h1",{children:"error"}),children:[a===C.taker?o(De,{takerConfirmed:xe,takerClaim:Ee}):null,a===C.maker?o(Pe,{makerConfirmed:Ne}):null]})})]}),o(F,{fallback:o("h1",{children:"error"}),children:o(Le,{sendMessage:()=>{},setMessage:()=>{},message:"",addressOrName:t,avatar:"",chatMessages:[]})})]})]}):f?o("h1",{children:"loading..."}):b?o("h1",{children:"error"}):null};export{Xt as default};
