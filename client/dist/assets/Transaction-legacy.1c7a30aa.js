System.register(["./index-legacy.f49cb8cc.js","./react-error-boundary.esm-legacy.b980c32e.js"],(function(t,e){"use strict";var s,r,n,i,o,a,c,h,l,p,u,d,f,m,y,g,b;return{setters:[t=>{s=t.a,r=t.j,n=t.z,i=t.l,o=t.F,a=t.B,c=t.m,h=t.o,l=t.n,p=t.D,u=t.g,d=t.E,f=t.O},t=>{m=t.u,y=t.a,g=t.v,b=t.E}],execute:function(){const e=({color:t})=>s("svg",{width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s("path",{d:"M29.42 0.245268C28.9746 -0.056841 28.3988 -0.082505 27.9279 0.182983L0.710867 15.6504C0.245403 15.9199 -0.0295416 16.4238 0.00252948 16.957C0.0346064 17.4917 0.368168 17.9625 0.862372 18.1693L9.85376 21.9416V28.592C9.85376 29.1065 10.1351 29.5787 10.5869 29.826C10.7979 29.9414 11.0266 30 11.2085 30C11.4733 30 11.7385 29.9249 11.9703 29.7766L18.4925 25.5895L24.2732 28.0153C24.4483 28.0886 24.6334 28.1252 24.8185 28.1252C25.0577 28.1252 25.296 28.0648 25.5095 27.9439C25.8879 27.7315 26.1476 27.3544 26.2104 26.9255L29.9641 1.61302C30.0945 1.08046 29.8599 0.549194 29.42 0.245268ZM21.6603 6.98437L10.6864 19.2246L4.58837 16.6816L21.6603 6.98437ZM12.6161 26.0156V23.1234L15.3405 24.2666L12.6161 26.0156ZM23.7424 24.7207L13.3844 20.3736L26.5577 5.75449L23.7424 24.7207Z",className:`active:fill-${t} active:scale-105 transition-all duration-500`,fill:"#C6C6C6"})}),v=({chatMessages:t,addressOrName:i,avatar:o,message:a,setMessage:c,sendMessage:h})=>r("div",{className:"bg-white rounded-[20px] relative shadow-customDark",children:[s("div",{className:"bg-purple rounded-t-[20px] h-[70px] px-[18px] flex items-center",children:r("div",{className:"flex items-center gap-2",children:[s("img",{className:"rounded-[50%]",src:o||"/assets/ava.73445bf0.svg",width:55,height:55,alt:""}),r("div",{className:"flex flex-col justify-start",children:[s("span",{className:"text-white font-bold",children:n(i)}),s("span",{className:"text-white text-sm",children:"online"})]})]})}),s("div",{className:"h-52",children:t}),r("div",{className:"flex absolute bottom-0 items-center border-t-2 border-gray pr-5 w-full",children:[s("input",{onChange:t=>c(t.target.value),className:"h-[70px] rounded-b-[20px] pl-5 w-full outline-none font-bold text-sm",placeholder:"Type some message..."}),s("button",{className:"",onClick:()=>h(a),children:s(e,{color:"purple"})})]})]}),k=({makerConfirmed:t})=>{const{step:e}=m((t=>t.transactionReducer)),n=i();return r(o,{children:[1===e||2===e?s(a,{name:"Funds recieved",onClick:()=>t(),disabled:1===e}):null,3===e?s(a,{name:"Go to Home page",onClick:()=>n("/"),color:"bg-purple"}):null]})},w=({takerConfirmed:t,takerClaim:e})=>{const{step:n}=m((t=>t.transactionReducer));return r(o,{children:[1===n?s(a,{onClick:()=>t(),name:"Done",color:"bg-purple"}):null,2===n?s("span",{className:"text-xl font-bold",children:"Wating for confirmation..."}):null,3===n?s(a,{onClick:()=>e(),name:"Claim",color:"bg-purple"}):null]})},x=({id:t,time:e})=>{const s=new Date(e);return r("div",{className:"flex flex-col font-bold",children:[r("span",{children:["Created at: ",(n=s,`${n.getMonth()<10?`0${n.getMonth()}`:n.getMonth()}.${n.getDate()<10?`0${n.getDate()}`:n.getDate()}.${n.getFullYear()} ${n.getHours()<10?`0${n.getHours()}`:n.getHours()}:${n.getMinutes()<10?`0${n.getMinutes()}`:n.getMinutes()}:${n.getSeconds()<10?`0${n.getSeconds()}`:n.getSeconds()}`)]}),r("span",{children:["Order number: ",t]})]});var n},N=({offer:t})=>r("div",{className:"flex justify-between items-center p-5 font-bold wrapper",children:[r("div",{className:"flex flex-col",children:[r("span",{children:["You send: ",t?.crypto.symbol]}),r("span",{children:["You send: ",t.fiat.ticker]})]}),s("div",{children:r("span",{children:["Amount: ",t?.totalAmount," ",t?.fiat.ticker]})}),s("div",{children:r("span",{children:["Unit Price: ",t?.unitPrice," ",t?.fiat.ticker]})}),r("div",{children:["Quantity: ",t?.totalQuantity," ",t?.crypto.symbol]})]}),C=({amount:t})=>r("div",{className:"h-[40vh] flex justify-center items-center text-center font-bold text-xl",children:["Payment sent ",s("br",{})," Please, comfirm if funds are recieved ",s("br",{})," You should recieve: ",t," ","RUB"]}),_=()=>s("div",{children:s("div",{className:"flex justify-center items-center h-[400px]",children:r("div",{className:"flex flex-col items-center gap-2",children:[r("div",{className:"flex text-2xl gap-2 mb-[20px]",children:[s("span",{className:"font-bold",children:"Success"}),s("img",{src:"/assets/confeti.6cb7aaa7.png",height:40,width:40})]}),s("span",{className:"font-bold text-lg",children:"How was it?"}),r("div",{className:"flex items-center gap-4",children:[s("img",{src:"/assets/bad.cf6adbca.png",height:40,width:40,className:"hover:scale-110 transition-transform duration-300 cursor-pointer"}),s("img",{src:"/assets/neutral.13177871.png",height:40,width:40,className:"hover:scale-110 transition-transform duration-300 cursor-pointer"}),s("img",{src:"/assets/good.b9990982.png",height:40,width:40,className:"hover:scale-110 transition-transform duration-300 cursor-pointer"})]})]})})}),E=()=>s("div",{className:"h-[40vh] flex justify-center items-center font-bold text-xl",children:"Waiting for other user transaction"}),A=({offer:t})=>{const{step:e}=m((t=>t.transactionReducer));return r(o,{children:[1===e?s(E,{}):null,2===e?s(C,{amount:t?.amount,fiat:t?.fiat.name}):null,3===e?s(_,{}):null]})},R=({payment:t})=>{const{setSelectedPayment:e}=y();return r("button",{onClick:()=>e(t),className:"flex items-center p-[10px] rounded-[15px] border font-bold inputBorder",children:[s("img",{src:t?.bank?.logoUrl,className:"w-8 h-8"}),t?.bank?.name]})},T=()=>s("div",{className:"bg-yellow rounded-[15px] px-[20px] py-[10px] font-bold",children:r("p",{className:"text-sm",children:["Please check payment info twice before sending transaction.",s("br",{}),"Tradecourt are not responsible for lost transactions."]})}),O=({payMethods:t})=>{const{selectedPayment:e}=m((t=>t.transactionReducer)),{cardNumber:n,region:i,bank:o,paymentDescription:a}=e;return r("div",{children:[s("div",{className:"flex space-x-2 items-center overflow-x-auto mb-4",children:t.map((t=>s(R,{payment:t},g())))}),r("div",{className:"flex flex-col gap-y-[10px] font-bold",children:[r("div",{className:"flex flex-col",children:[s("span",{className:"text-gray-300 text-xs",children:"Bank"}),s("span",{children:o?.name})]}),r("div",{className:"flex flex-col",children:[s("span",{className:"text-gray-300 text-xs",children:"Region"}),s("span",{children:i.name})]}),r("div",{className:"flex flex-col",children:[s("span",{className:"text-gray-300 text-xs",children:"Card Number"}),s("span",{children:n})]}),a?r("div",{className:"flex flex-col",children:[s("span",{className:"text-gray-300 text-xs",children:"Payment Description"}),s("span",{children:a})]}):null,s(T,{})]})]})},S=({offer:t})=>{const{step:e}=m((t=>t.transactionReducer));return r(o,{children:[1===e||2===e?s(O,{payMethods:t.payMethods}):null,3===e?s(_,{}):null]})};var B=(t=>(t.taker="taker",t.maker="maker",t))(B||{});const L=Object.create(null);L.open="0",L.close="1",L.ping="2",L.pong="3",L.message="4",L.upgrade="5",L.noop="6";const P=Object.create(null);Object.keys(L).forEach((t=>{P[L[t]]=t}));const j={type:"error",data:"parser error"},M="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),D="function"==typeof ArrayBuffer,q=({type:t,data:e},s,r)=>{return M&&e instanceof Blob?s?r(e):I(e,r):D&&(e instanceof ArrayBuffer||(n=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer))?s?r(e):I(new Blob([e]),r):r(L[t]+(e||""));var n},I=(t,e)=>{const s=new FileReader;return s.onload=function(){const t=s.result.split(",")[1];e("b"+t)},s.readAsDataURL(t)},F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<F.length;t++)U[F.charCodeAt(t)]=t;const V="function"==typeof ArrayBuffer,H=(t,e)=>{if("string"!=typeof t)return{type:"message",data:$(t,e)};const s=t.charAt(0);return"b"===s?{type:"message",data:W(t.substring(1),e)}:P[s]?t.length>1?{type:P[s],data:t.substring(1)}:{type:P[s]}:j},W=(t,e)=>{if(V){const s=(t=>{let e,s,r,n,i,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const h=new ArrayBuffer(o),l=new Uint8Array(h);for(e=0;e<a;e+=4)s=U[t.charCodeAt(e)],r=U[t.charCodeAt(e+1)],n=U[t.charCodeAt(e+2)],i=U[t.charCodeAt(e+3)],l[c++]=s<<2|r>>4,l[c++]=(15&r)<<4|n>>2,l[c++]=(3&n)<<6|63&i;return h})(t);return $(s,e)}return{base64:!0,data:t}},$=(t,e)=>"blob"===e&&t instanceof ArrayBuffer?new Blob([t]):t,Y=String.fromCharCode(30);function K(t){if(t)return function(t){for(var e in K.prototype)t[e]=K.prototype[e];return t}(t)}K.prototype.on=K.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},K.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},K.prototype.off=K.prototype.removeListener=K.prototype.removeAllListeners=K.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n=0;n<r.length;n++)if((s=r[n])===e||s.fn===e){r.splice(n,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},K.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(s){r=0;for(var n=(s=s.slice(0)).length;r<n;++r)s[r].apply(this,e)}return this},K.prototype.emitReserved=K.prototype.emit,K.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},K.prototype.hasListeners=function(t){return!!this.listeners(t).length};const z="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function J(t,...e){return e.reduce(((e,s)=>(t.hasOwnProperty(s)&&(e[s]=t[s]),e)),{})}const X=setTimeout,Z=clearTimeout;function G(t,e){e.useNativeTimers?(t.setTimeoutFn=X.bind(z),t.clearTimeoutFn=Z.bind(z)):(t.setTimeoutFn=setTimeout.bind(z),t.clearTimeoutFn=clearTimeout.bind(z))}class Q extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class tt extends K{constructor(t){super(),this.writable=!1,G(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e,s){return super.emitReserved("error",new Q(t,e,s)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=H(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}const et="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),st={};let rt,nt=0,it=0;function ot(t){let e="";do{e=et[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function at(){const t=ot(+new Date);return t!==rt?(nt=0,rt=t):t+"."+ot(nt++)}for(;it<64;it++)st[et[it]]=it;function ct(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}let ht=!1;try{ht="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch($t){}const lt=ht;function pt(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||lt))return new XMLHttpRequest}catch(s){}if(!e)try{return new(z[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(s){}}function ut(){}const dt=null!=new pt({xdomain:!1}).responseType;class ft extends K{constructor(t,e){super(),G(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=J(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new pt(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(s){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{e.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof e.status?e.status:0)}),0))},e.send(this.data)}catch(s){return void this.setTimeoutFn((()=>{this.onError(s)}),0)}"undefined"!=typeof document&&(this.index=ft.requestsCount++,ft.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=ut,t)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete ft.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function mt(){for(let t in ft.requests)ft.requests.hasOwnProperty(t)&&ft.requests[t].abort()}ft.requestsCount=0,ft.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",mt):"function"==typeof addEventListener&&addEventListener("onpagehide"in z?"pagehide":"unload",mt,!1));const yt="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),gt=z.WebSocket||z.MozWebSocket,bt="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),vt={websocket:class extends tt{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,s=bt?{}:J(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=bt?new gt(t,e,s):e?new gt(t,e):new gt(t)}catch($t){return this.emitReserved("error",$t)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],r=e===t.length-1;q(s,this.supportsBinary,(t=>{try{this.ws.send(t)}catch(e){}r&&yt((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=at()),this.supportsBinary||(t.b64=1);const r=ct(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(r.length?"?"+r:"")}check(){return!!gt}},polling:class extends tt{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){const e="https:"===location.protocol;let s=location.port;s||(s=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||s!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=dt&&!e}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const s=t.split(Y),r=[];for(let n=0;n<s.length;n++){const t=H(s[n],e);if(r.push(t),"error"===t.type)break}return r})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const s=t.length,r=new Array(s);let n=0;t.forEach(((t,i)=>{q(t,!1,(t=>{r[i]=t,++n===s&&e(r.join(Y))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=at()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port);const r=ct(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(r.length?"?"+r:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new ft(this.uri(),t)}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},kt=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,wt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function xt(t){const e=t,s=t.indexOf("["),r=t.indexOf("]");-1!=s&&-1!=r&&(t=t.substring(0,s)+t.substring(s,r).replace(/:/g,";")+t.substring(r,t.length));let n=kt.exec(t||""),i={},o=14;for(;o--;)i[wt[o]]=n[o]||"";return-1!=s&&-1!=r&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(t,e){const s=/\/{2,9}/g,r=e.replace(s,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||r.splice(0,1),"/"==e.slice(-1)&&r.splice(r.length-1,1),r}(0,i.path),i.queryKey=function(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,r){e&&(s[e]=r)})),s}(0,i.query),i}class Nt extends K{constructor(t,e={}){super(),t&&"object"==typeof t&&(e=t,t=null),t?(t=xt(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=xt(e.host).host),G(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},s=t.split("&");for(let r=0,n=s.length;r<n;r++){let t=s[r].split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const s=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new vt[t](s)}open(){let t;if(this.opts.rememberUpgrade&&Nt.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),s=!1;Nt.priorWebsocketSuccess=!1;const r=()=>{s||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!s)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;Nt.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{s||"closed"!==this.readyState&&(h(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function n(){s||(s=!0,h(),e.close(),e=null)}const i=t=>{const s=new Error("probe error: "+t);s.transport=e.name,n(),this.emitReserved("upgradeError",s)};function o(){i("transport closed")}function a(){i("socket closed")}function c(t){e&&t.name!==e.name&&n()}const h=()=>{e.removeListener("open",r),e.removeListener("error",i),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",r),e.once("error",i),e.once("close",o),this.once("close",a),this.once("upgrading",c),e.open()}onOpen(){if(this.readyState="open",Nt.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const r=this.writeBuffer[s].data;if(r&&(t+="string"==typeof(e=r)?function(t){let e=0,s=0;for(let r=0,n=t.length;r<n;r++)e=t.charCodeAt(r),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(r++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))),s>0&&t>this.maxPayload)return this.writeBuffer.slice(0,s);t+=2}var e;return this.writeBuffer}write(t,e,s){return this.sendPacket("message",t,e,s),this}send(t,e,s){return this.sendPacket("message",t,e,s),this}sendPacket(t,e,s,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof s&&(r=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const n={type:t,data:e,options:s};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),r&&this.once("flush",r),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},s=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():t()})):this.upgrading?s():t()),this}onError(t){Nt.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let s=0;const r=t.length;for(;s<r;s++)~this.transports.indexOf(t[s])&&e.push(t[s]);return e}}Nt.protocol=4;const Ct="function"==typeof ArrayBuffer,_t=Object.prototype.toString,Et="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===_t.call(Blob),At="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===_t.call(File);function Rt(t){return Ct&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||Et&&t instanceof Blob||At&&t instanceof File}function Tt(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,s=t.length;e<s;e++)if(Tt(t[e]))return!0;return!1}if(Rt(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return Tt(t.toJSON(),!0);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&Tt(t[s]))return!0;return!1}function Ot(t){const e=[],s=t.data,r=t;return r.data=St(s,e),r.attachments=e.length,{packet:r,buffers:e}}function St(t,e){if(!t)return t;if(Rt(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}if(Array.isArray(t)){const s=new Array(t.length);for(let r=0;r<t.length;r++)s[r]=St(t[r],e);return s}if("object"==typeof t&&!(t instanceof Date)){const s={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=St(t[r],e));return s}return t}function Bt(t,e){return t.data=Lt(t.data,e),t.attachments=void 0,t}function Lt(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=Lt(t[s],e);else if("object"==typeof t)for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=Lt(t[s],e));return t}var Pt;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(Pt||(Pt={}));class jt extends K{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t),e.type===Pt.BINARY_EVENT||e.type===Pt.BINARY_ACK?(this.reconstructor=new Mt(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Rt(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(void 0===Pt[s.type])throw new Error("unknown packet type "+s.type);if(s.type===Pt.BINARY_EVENT||s.type===Pt.BINARY_ACK){const r=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const n=t.substring(r,e);if(n!=Number(n)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(n)}if("/"===t.charAt(e+1)){const r=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);s.nsp=t.substring(r,e)}else s.nsp="/";const r=t.charAt(e+1);if(""!==r&&Number(r)==r){const r=e+1;for(;++e;){const s=t.charAt(e);if(null==s||Number(s)!=s){--e;break}if(e===t.length)break}s.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(!jt.isPayloadValid(s.type,r))throw new Error("invalid payload");s.data=r}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case Pt.CONNECT:return"object"==typeof e;case Pt.DISCONNECT:return void 0===e;case Pt.CONNECT_ERROR:return"string"==typeof e||"object"==typeof e;case Pt.EVENT:case Pt.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case Pt.ACK:case Pt.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Mt{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=Bt(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Dt=Object.freeze(Object.defineProperty({__proto__:null,protocol:5,get PacketType(){return Pt},Encoder:class{constructor(t){this.replacer=t}encode(t){return t.type!==Pt.EVENT&&t.type!==Pt.ACK||!Tt(t)?[this.encodeAsString(t)]:(t.type=t.type===Pt.EVENT?Pt.BINARY_EVENT:Pt.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=""+t.type;return t.type!==Pt.BINARY_EVENT&&t.type!==Pt.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=Ot(t),s=this.encodeAsString(e.packet),r=e.buffers;return r.unshift(s),r}},Decoder:jt},Symbol.toStringTag,{value:"Module"}));function qt(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const It=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ft extends K{constructor(t,e,s){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[qt(t,"open",this.onopen.bind(this)),qt(t,"packet",this.onpacket.bind(this)),qt(t,"error",this.onerror.bind(this)),qt(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(It.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');e.unshift(t);const s={type:Pt.EVENT,data:e,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++,r=e.pop();this._registerAckCallback(t,r),s.id=t}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,e){const s=this.flags.timeout;if(void 0===s)return void(this.acks[t]=e);const r=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),s);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(r),e.apply(this,[null,...t])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this.packet({type:Pt.CONNECT,data:t})})):this.packet({type:Pt.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Pt.CONNECT:if(t.data&&t.data.sid){const e=t.data.sid;this.onconnect(e)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Pt.EVENT:case Pt.BINARY_EVENT:this.onevent(t);break;case Pt.ACK:case Pt.BINARY_ACK:this.onack(t);break;case Pt.DISCONNECT:this.ondisconnect();break;case Pt.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let s=!1;return function(...r){s||(s=!0,e.packet({type:Pt.ACK,id:t,data:r}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Pt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e)s.apply(this,t.data)}}}function Ut(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Ut.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-s:t+s}return 0|Math.min(t,this.max)},Ut.prototype.reset=function(){this.attempts=0},Ut.prototype.setMin=function(t){this.ms=t},Ut.prototype.setMax=function(t){this.max=t},Ut.prototype.setJitter=function(t){this.jitter=t};class Vt extends K{constructor(t,e){var s;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,G(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=e.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new Ut({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const r=e.parser||Dt;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Nt(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const r=qt(e,"open",(function(){s.onopen(),t&&t()})),n=qt(e,"error",(e=>{s.cleanup(),s._readyState="closed",this.emitReserved("error",e),t?t(e):s.maybeReconnectOnOpen()}));if(!1!==this._timeout){const t=this._timeout;0===t&&r();const s=this.setTimeoutFn((()=>{r(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(r),this.subs.push(n),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(qt(t,"ping",this.onping.bind(this)),qt(t,"data",this.ondata.bind(this)),qt(t,"error",this.onerror.bind(this)),qt(t,"close",this.onclose.bind(this)),qt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){yt((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s||(s=new Ft(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const s of e)if(this.nsps[s].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Ht={};function Wt(t,e){"object"==typeof t&&(e=t,t=void 0);const s=function(t,e="",s){let r=t;s=s||"undefined"!=typeof location&&location,null==t&&(t=s.protocol+"//"+s.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?s.protocol+t:s.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==s?s.protocol+"//"+t:"https://"+t),r=xt(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const n=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+n+":"+r.port+e,r.href=r.protocol+"://"+n+(s&&s.port===r.port?"":":"+r.port),r}(t,(e=e||{}).path||"/socket.io"),r=s.source,n=s.id,i=s.path,o=Ht[n]&&i in Ht[n].nsps;let a;return e.forceNew||e["force new connection"]||!1===e.multiplex||o?a=new Vt(r,e):(Ht[n]||(Ht[n]=new Vt(r,e)),a=Ht[n]),s.query&&!e.query&&(e.query=s.queryKey),a.socket(s.path,e)}Object.assign(Wt,{Manager:Vt,Socket:Ft,io:Wt,connect:Wt}),t("default",(()=>{const t=Wt("http://127.0.0.1:3030");t.on("approvalStage",(()=>{g(2)})),t.on("successStage",(()=>{g(3)}));const{id:e}=p(),{address:n}=u(),{setSelectedPayment:i,setRole:a,setStep:g}=y(),{role:C}=m((t=>t.transactionReducer)),{data:_,isLoading:E,isSuccess:R,isError:T}=d(["get offer by id"],(()=>f.getByID(e)),{select:({data:t})=>t.data.room,onSuccess:t=>{a(t.role),W({id:e,role:C}),g("waiting taker"===t.stage?1:"taker send"===t.stage?2:"maker recieved"===t.stage?3:null),i(t.offer.payMethods[0])}}),{data:O,takerApprove:L,prepareTxStatus:P,contractTxStatus:j}=((t,e)=>{const s=[t,e],{config:r,status:n}=c({...l,functionName:"takerApprove",args:s}),{data:i,status:o,writeAsync:a}=h(r);return{data:i,prepareTxStatus:n,contractTxStatus:o,takerApprove:a}})(_?.offer.roomId,_?.takerNumber),{data:M,makerApprove:D,makerContractTxStatus:q,makerPrepareTxStatus:I}=((t,e)=>{const s=[t,e],{config:r,status:n}=c({...l,functionName:"makerApprove",args:s}),{data:i,status:o,writeAsync:a}=h(r);return{data:i,makerApprove:a,makerPrepareTxStatus:n,makerContractTxStatus:o}})(_?.offer.roomId,_?.takerNumber),{takerWithdraw:F,takerWithdrawPrepareTxStatus:U,takerWithdrawTxData:V,takerWithdrawTxStatus:H}=((t,e)=>{const s=[t,e],{config:r,status:n}=c({...l,functionName:"takerWithdraw",args:s}),{data:i,status:o,writeAsync:a}=h(r);return{takerWithdrawTxData:i,takerWithdrawPrepareTxStatus:n,takerWithdrawTxStatus:o,takerWithdraw:a}})(_?.offer.roomId,_?.takerNumber),W=e=>{t.emit("joinOffer",e)};return R?r(o,{children:[s(N,{offer:_?.offer}),r("div",{className:"grid grid-cols-form gap-5 mt-5",children:[r("div",{children:[s("div",{className:"wrapper p-5",children:r(b,{fallback:s("h1",{children:"error"}),children:[C===B.taker?s(S,{offer:_.offer}):null,C===B.maker?s(A,{offer:_.offer}):null,s(x,{id:_._id,time:_.createdAt})]})}),s("div",{className:"wrapper p-5 mt-5",children:r(b,{fallback:s("h1",{children:"error"}),children:[C===B.taker?s(w,{takerConfirmed:async()=>{await(L?.()),await f.takerSend(e),t.emit("takerConfirmed",e)},takerClaim:async()=>{await(F?.()),await f.claimByID(e)}}):null,C===B.maker?s(k,{makerConfirmed:async()=>{await(D?.()),await f.makerRecieved(e),t.emit("makerConfirmed",e)}}):null]})})]}),s(b,{fallback:s("h1",{children:"error"}),children:s(v,{sendMessage:()=>{},setMessage:()=>{},message:"",addressOrName:n,avatar:"",chatMessages:[]})})]})]}):E?s("h1",{children:"loading..."}):T?s("h1",{children:"error"}):null}))}}}));
